<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>How-to · Fastback.jl</title><meta name="title" content="How-to · Fastback.jl"/><meta property="og:title" content="How-to · Fastback.jl"/><meta property="twitter:title" content="How-to · Fastback.jl"/><meta name="description" content="Documentation for Fastback.jl."/><meta property="og:description" content="Documentation for Fastback.jl."/><meta property="twitter:description" content="Documentation for Fastback.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><script type="module" defer>
    import { codeToHtml } from 'https://esm.sh/shiki@1.3.0'

    async function highlightCode(lang, el) {
        const code = el.textContent
        if (lang == "julia-repl")
            lang = "julia"
        try {
            el.outerHTML = await codeToHtml(code, {
                lang: lang,
                theme: 'monokai',
                //theme: 'github-light-default',
                //theme: 'github-dark-dimmed',
                //theme: 'dark-plus',
                //themes: {
                //    light: 'github-dark-dimmed',
                //    dark: 'github-dark',
                //}
            })
        } catch (e) {
            console.error(`Failed to highlight code on element with class="${el.classList}" using shiki: `, e)
        }
    }

    document.addEventListener('DOMContentLoaded', async function() {
        console.log('run code highlighting using shiki')
        const els = document.querySelectorAll("code[class^='language-']")
        const promises = []
        for (const el of els) {
            const cls = Array.from(el.classList).filter(x => x.startsWith("language-"))
            if (!cls.length)
                continue
            const lang = cls[0].substring(9)
            el.classList.add('shiki-highlighted')
            
            promises.push(highlightCode(lang, el))
        }
        await Promise.all(promises)
    })
</script>
<link href="../assets/styles.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img class="docs-light-only" src="../assets/logo.png" alt="Fastback.jl logo"/><img class="docs-dark-only" src="../assets/logo-dark.png" alt="Fastback.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../getting_started/">Getting started</a></li><li><a class="tocitem" href="../basic_setup/">Basic setup</a></li><li><a class="tocitem" href="../concepts/">Accounting model and event loop</a></li><li><a class="tocitem" href="../execution_errors/">Execution and errors</a></li><li><a class="tocitem" href="../pitfalls/">Pitfalls and gotchas</a></li><li class="is-active"><a class="tocitem" href>How-to</a><ul class="internal"><li><a class="tocitem" href="#Drive-the-engine-with-process_step!"><span>Drive the engine with <code>process_step!</code></span></a></li><li><a class="tocitem" href="#Manual-event-loop"><span>Manual event loop</span></a></li><li><a class="tocitem" href="#Multi-currency-equity-in-base-currency"><span>Multi-currency equity in base currency</span></a></li><li><a class="tocitem" href="#Use-Tables.jl-outputs"><span>Use Tables.jl outputs</span></a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/gen/1_random_trading/">Random trading</a></li><li><a class="tocitem" href="../examples/gen/2_portfolio_trading/">Portfolio trading</a></li><li><a class="tocitem" href="../examples/gen/3_multi_currency/">Multi-Currency trading</a></li><li><a class="tocitem" href="../examples/gen/4_USDm_perp_trading/">USD-M perpetual trading</a></li><li><a class="tocitem" href="../examples/gen/5_VOO_vs_MES_comparison/">VOO vs MES cost comparison</a></li></ul></li><li><span class="tocitem">Plotting</span><ul><li><a class="tocitem" href="../plotting/gen/1_plots_extension/">Plots extensions</a></li></ul></li><li><span class="tocitem">Integrations</span><ul><li><a class="tocitem" href="../integrations/">Overview</a></li><li><a class="tocitem" href="../integrations/gen/1_Tables_integration/">Tables.jl</a></li><li><a class="tocitem" href="../integrations/gen/2_NanoDates_integration/">NanoDates.jl</a></li><li><a class="tocitem" href="../integrations/gen/3_Timestamps64_integration/">Timestamps64.jl</a></li></ul></li><li><a class="tocitem" href="../api_index/">API index</a></li><li><a class="tocitem" href="../glossary/">Glossary</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>How-to</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>How-to</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/rbeeli/Fastback.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/rbeeli/Fastback.jl/blob/main/docs/src/how_to.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-recipes"><a class="docs-heading-anchor" href="#How-to-recipes">How-to recipes</a><a id="How-to-recipes-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-recipes" title="Permalink"></a></h1><p>Short, practical snippets for common workflows.</p><h2 id="Drive-the-engine-with-process_step!"><a class="docs-heading-anchor" href="#Drive-the-engine-with-process_step!">Drive the engine with <code>process_step!</code></a><a id="Drive-the-engine-with-process_step!-1"></a><a class="docs-heading-anchor-permalink" href="#Drive-the-engine-with-process_step!" title="Permalink"></a></h2><pre><code class="language-julia hljs">using Fastback
using Dates

er = ExchangeRates()
acc = Account(;
    broker=FlatFeeBroker(pct=0.001),
    funding=AccountFunding.Margined,
    base_currency=CashSpec(:USD),
    exchange_rates=er,
)
usd = cash_asset(acc, :USD)
eur = register_cash_asset!(acc, CashSpec(:EUR))
deposit!(acc, usd, 10_000.0)
deposit!(acc, eur, 5_000.0)

inst = register_instrument!(acc, perpetual_instrument(
    :BTCUSD, :BTC, :USD;
    margin_requirement=MarginRequirement.PercentNotional,
    margin_init_long=0.10,
    margin_init_short=0.10,
    margin_maint_long=0.05,
    margin_maint_short=0.05,
))

dt = DateTime(2024, 1, 1, 0)
bid, ask, last = 100.0, 100.5, 100.2
funding_rate = 0.0001
eurusd = 1.07

fx_updates = [FXUpdate(eur, usd, eurusd)]
marks = [MarkUpdate(inst.index, bid, ask, last)]
funding = [FundingUpdate(inst.index, funding_rate)]

process_step!(acc, dt; fx_updates=fx_updates, marks=marks, funding=funding, expiries=true, liquidate=false)</code></pre><p>Notes:</p><ul><li><code>process_step!</code> enforces non-decreasing timestamps and accrues interest/borrow fees before same-step FX/mark updates.</li><li>FX updates are applied on the account&#39;s <code>ExchangeRates</code>.</li><li>Cash registration is account-owned: use <code>register_cash_asset!(acc, CashSpec(:EUR))</code> and <code>ExchangeRates</code> is resized automatically.</li><li>Setup order: create <code>Account</code>, register additional cash assets, set FX rates, then fund it.</li><li>Orders are filled separately with <code>fill_order!</code>.</li><li>For <code>MarginRequirement.PercentNotional</code>, <code>margin_init_*</code> / <code>margin_maint_*</code> are equity fractions of notional (<code>0.10</code> means 10%).</li></ul><h2 id="Manual-event-loop"><a class="docs-heading-anchor" href="#Manual-event-loop">Manual event loop</a><a id="Manual-event-loop-1"></a><a class="docs-heading-anchor-permalink" href="#Manual-event-loop" title="Permalink"></a></h2><p>Use this when you need custom ordering or extra side effects per step.</p><pre><code class="language-julia hljs"># advance time (accrues interest/borrow fees by default)
advance_time!(acc, dt)

# optional FX update
update_rate!(er, eur, usd, 1.07)

# mark positions (also revalues equity for open positions)
update_marks!(acc, inst, dt, bid, ask, last)

# funding and expiries (if applicable)
apply_funding!(acc, inst, dt; funding_rate=funding_rate)
process_expiries!(acc, dt)

# optional liquidation pass
is_under_maintenance(acc) &amp;&amp; liquidate_to_maintenance!(acc, dt)</code></pre><h2 id="Multi-currency-equity-in-base-currency"><a class="docs-heading-anchor" href="#Multi-currency-equity-in-base-currency">Multi-currency equity in base currency</a><a id="Multi-currency-equity-in-base-currency-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-currency-equity-in-base-currency" title="Permalink"></a></h2><pre><code class="language-julia hljs">er = ExchangeRates()
acc = Account(;
    broker=FlatFeeBroker(pct=0.001),
    funding=AccountFunding.Margined,
    base_currency=CashSpec(:USD),
    exchange_rates=er,
)
usd = cash_asset(acc, :USD)
eur = register_cash_asset!(acc, CashSpec(:EUR))
deposit!(acc, usd, 10_000.0)
deposit!(acc, eur, 5_000.0)

update_rate!(er, eur, usd, 1.07)
equity_base_ccy(acc) # total equity in USD</code></pre><h2 id="Use-Tables.jl-outputs"><a class="docs-heading-anchor" href="#Use-Tables.jl-outputs">Use Tables.jl outputs</a><a id="Use-Tables.jl-outputs-1"></a><a class="docs-heading-anchor-permalink" href="#Use-Tables.jl-outputs" title="Permalink"></a></h2><pre><code class="language-julia hljs">using DataFrames

df_trades = DataFrame(trades_table(acc))
df_positions = DataFrame(positions_table(acc))
df_balances = DataFrame(balances_table(acc))
df_equities = DataFrame(equities_table(acc))
df_cashflows = DataFrame(cashflows_table(acc))</code></pre><p>Notes:</p><ul><li><code>df_trades.fill_pnl_settle</code> is the additive gross fill-settled P&amp;L column.</li><li><code>df_trades.cash_delta_settle</code> is the additive net cash movement per fill.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../pitfalls/">« Pitfalls and gotchas</a><a class="docs-footer-nextpage" href="../examples/gen/1_random_trading/">Random trading »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Sunday 22 February 2026 00:48">Sunday 22 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
